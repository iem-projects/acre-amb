#N canvas 570 248 643 393 10;
#X declare -lib zexy;
#X declare -lib iemlib1;
#X declare -lib iemlib2;
#X declare -path ../../;
#X declare -stdpath iemlib;
#N canvas 439 133 450 464 init 0;
#X obj 30 40 declare -lib zexy;
#X obj 27 65 declare -lib iemlib1;
#X obj 33 89 declare -lib iemlib2;
#X obj 32 11 declare -path ../../;
#X obj 86 201 amb/initbangs;
#X obj 43 135 loadbang;
#X msg 311 215 \; pd dsp \$1;
#X obj 312 183 r /amb/cal/dsp;
#X msg 45 259 \; /amb/cal/dsp 1;
#X obj 132 155 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 65 231 s /amb/cal/initbang;
#X obj 44 161 t b b b b;
#X obj 212 29 declare -stdpath iemlib;
#X connect 5 0 11 0;
#X connect 7 0 6 0;
#X connect 9 0 4 0;
#X connect 11 0 8 0;
#X connect 11 1 10 0;
#X connect 11 2 4 0;
#X restore 30 28 pd init;
#N canvas 323 106 450 449 OUT 0;
#X obj 101 101 cnv 15 148 198 empty empty ADC/DAC 2 7 0 14 -233017
-66577 0;
#X obj 104 131 vsl 15 128 0 127 0 0 /amb/cal/out/vol /amb/cal/out/vol
master 0 -9 0 10 -258113 -1 -1 0 1;
#X obj 103 269 nbx 3 14 -1e+37 1e+37 0 0 /amb/cal/out/vol /amb/cal/out/vol
empty 0 -8 0 10 -258113 -1 -1 0 256;
#X obj 134 139 vu 15 120 /amb/cal/out/vu DAC -1 -8 0 10 -66577 -1 1
0;
#X obj 197 139 vu 15 120 /amb/cal/adc/vu ADC -1 -8 0 10 -66577 -1 1
0;
#X text 200 269 IN;
#X coords 0 -1 1 1 150 200 1 100 100;
#X restore 28 55 pd OUT;
#N canvas 523 342 257 405 signal_in 0;
#X obj 11 11 cnv 15 98 198 empty empty pre-amp/limit 2 7 0 10 -228856
-66577 0;
#X obj 66 41 vu 15 120 /amb/cal/in/vu input -1 -8 0 10 -66577 -1 1
0;
#X obj 17 40 vsl 15 128 0 127 0 0 /amb/cal/in/vol /amb/cal/in/vol vol
0 -9 0 10 -204786 -1 -1 0 1;
#X obj 17 174 nbx 3 14 -1e+37 1e+37 0 0 /amb/cal/in/vol /amb/cal/in/vol
empty 0 -8 0 10 -204786 -1 -1 0 256;
#X obj 50 42 vsl 8 100 -100 0 0 0 /amb/cal/in/lim /amb/cal/in/lim lim
-5 -9 0 10 -262144 -1 -1 9900 1;
#X coords 0 -1 1 1 100 200 1 10 10;
#X restore 178 55 pd signal_in;
#N canvas 245 293 257 258 signal_gen 0;
#X obj 11 11 cnv 15 98 198 empty empty noise-gen 2 7 0 10 -228856 -66577
0;
#X obj 62 61 vu 15 120 /amb/cal/noise/vu noise -1 -8 0 10 -66577 -1
1 0;
#X obj 17 40 vsl 15 128 0 127 0 0 /amb/cal/noise/vol /amb/cal/noise/vol
vol 0 -9 0 10 -204786 -1 -1 0 1;
#X obj 17 174 nbx 3 14 -1e+37 1e+37 0 0 /amb/cal/noise/vol /amb/cal/noise/vol
empty 0 -8 0 10 -204786 -1 -1 0 256;
#X obj 62 28 tgl 15 0 /amb/cal/noise/on /amb/cal/noise/on on 17 7 0
10 -204786 -1 -1 0 1;
#X coords 0 -1 1 1 100 200 2 10 10;
#X restore 278 55 pd signal_gen;
#X text 33 5 Correlation to measure delays;
#X obj 144 320 bng 15 250 50 0 /corr/trigger /corr/trigger /corr/trigger
17 7 0 10 -257985 -1 -1;
#X obj 141 343 tgl 15 0 /corr/v /corr/v /corr/v 17 7 0 10 -257985 -1
-1 0 1;
#X obj 145 301 nbx 3 14 -1e+37 1e+37 0 0 /corr/y /corr/y corr_y 0 -8
0 10 -257985 -1 -1 81 256;
#N canvas 501 58 547 216 DSP 1;
#N canvas 435 243 302 273 noise 0;
#X obj 21 240 outlet~;
#X obj 22 161 *~;
#X obj 86 75 dbtorms;
#X obj 86 97 pack 0 50;
#X obj 86 119 line~;
#X obj 21 97 noise~;
#X obj 36 184 prvu~;
#X obj 21 49 switch~;
#X obj 21 23 r /amb/cal/noise/on;
#X obj 86 50 r /amb/cal/noise/vol;
#X obj 51 219 s /amb/cal/noise/vu;
#X obj 21 121 hip~ 20;
#X connect 1 0 6 0;
#X connect 1 0 0 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 1 1;
#X connect 5 0 11 0;
#X connect 6 0 10 0;
#X connect 8 0 7 0;
#X connect 9 0 2 0;
#X connect 11 0 1 0;
#X restore 152 78 pd noise;
#X obj 161 104 throw~ out~;
#N canvas 494 435 381 300 input 0;
#X obj 20 56 r~ in1;
#X obj 20 110 *~;
#X obj 60 145 limiter~;
#X obj 20 144 z~ 9;
#X obj 20 166 *~;
#X obj 53 220 prvu~;
#X obj 98 78 dbtorms;
#X obj 98 100 pack 0 50;
#X obj 99 120 line~;
#X obj 63 171 rvu~;
#X obj 23 264 outlet~;
#X obj 53 243 s /amb/cal/in/vu;
#X obj 98 53 r /amb/cal/in/vol;
#X obj 63 194 s /amb/cal/in/lim;
#X text 127 151 limit to get sure;
#X text 66 11 prepare input from micro;
#X obj 20 78 hip~ 20;
#X connect 0 0 16 0;
#X connect 1 0 2 0;
#X connect 1 0 3 0;
#X connect 2 0 4 1;
#X connect 2 0 9 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 4 0 10 0;
#X connect 5 0 11 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 8 0 1 1;
#X connect 9 0 13 0;
#X connect 12 0 6 0;
#X connect 16 0 1 0;
#X restore 33 79 pd input;
#X obj 32 106 correlation 16384;
#N canvas 642 629 450 194 ADC 0;
#X obj 178 71 prvu~;
#X obj 107 64 s~ in1;
#X obj 107 33 adc~ 5;
#X obj 180 93 s /amb/cal/adc/vu;
#X text 173 34 Set ADC number;
#X connect 0 0 3 0;
#X connect 2 0 0 0;
#X connect 2 0 1 0;
#X restore 33 32 pd ADC;
#N canvas 168 325 617 298 DACs 1;
#X obj 107 66 r /amb/cal/initbang;
#X obj 106 120 acre/count_until;
#X obj 153 95 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 108 93 i 13;
#X obj 290 167 mxr/master/master~;
#X obj 272 69 ds/storage_logic /cal;
#X obj 108 35 amb/outs boxen 13 out;
#X obj 272 40 amb/outs_ds boxen 13 out /cal;
#X msg 108 151 \; /amb/out/\$1/vol 100 \; /amb/out/\$1/del 0;
#X connect 0 0 3 0;
#X connect 1 0 8 0;
#X connect 2 0 3 0;
#X connect 3 0 1 0;
#X restore 108 32 pd DACs;
#N canvas 603 334 450 300 output 0;
#X obj 102 77 dbtorms;
#X obj 100 102 pack 0 50;
#X obj 100 124 line~;
#X obj 83 148 *~;
#X obj 92 170 prvu~;
#X obj 81 30 catch~ out~;
#X obj 83 227 outlet~;
#X obj 102 57 r /amb/cal/out/vol;
#X obj 94 192 s /amb/cal/out/vu;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 3 1;
#X connect 3 0 4 0;
#X connect 3 0 6 0;
#X connect 4 0 8 0;
#X connect 5 0 3 0;
#X connect 7 0 0 0;
#X restore 257 47 pd output;
#X obj 387 48 r /amb/cal/out/nr;
#X obj 390 107 print outnr;
#X obj 256 107 throw~ /amb/out/1;
#X msg 388 74 set /amb/out/\$1;
#X text 44 149 Example for correllation 16384 and 13 speaker;
#X text 303 20 Routing of signal;
#X text 149 57 generator;
#X text 22 58 measurement input;
#X connect 0 0 1 0;
#X connect 0 0 3 1;
#X connect 2 0 3 0;
#X connect 6 0 9 0;
#X connect 7 0 10 0;
#X connect 10 0 8 0;
#X connect 10 0 9 0;
#X restore 96 29 pd DSP;
#X obj 524 51 mxr/master/ctl;
#X obj 338 275 bng 15 250 50 0 /corr/measurement /corr/measurement
/corr/measurement 17 7 0 10 -261682 -1 -1;
#X obj 335 306 nbx 5 14 -1e+37 1e+37 0 0 /corr/amp /corr/amp /corr/amp
0 -8 0 10 -261682 -1 -1 0 256;
#X obj 337 370 nbx 5 14 -1e+37 1e+37 0 0 /corr/delay /corr/delay /corr/delay
0 -8 0 10 -261682 -1 -1 0 256;
#X obj 334 336 nbx 3 14 -1e+37 1e+37 0 0 /amb/cal/out/nr /amb/cal/out/nr
/amb/cal/out/nr 0 -8 0 10 -261682 -1 -1 13 256;
#N canvas 293 58 638 573 automeasurement 0;
#X floatatom 36 135 5 0 0 0 - - -, f 5;
#X obj 51 90 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X floatatom 173 89 5 0 0 0 - - -, f 5;
#X text 219 90 messzeit;
#X obj 63 211 s /amb/cal/out/vol;
#X obj 30 22 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 30 42 t b b b;
#X msg 95 39 \; /amb/cal/out/vol 0;
#X obj 98 187 s /amb/cal/out/nr;
#X msg 63 189 100;
#X obj 54 268 s /corr/trigger;
#X obj 39 153 t b b f;
#X obj 55 292 del 100;
#X obj 55 316 s /corr/measurement;
#N canvas 0 50 450 250 (subpatch) 0;
#X array spk_amps 13 float 3;
#A 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
#X coords 0 100 12 0 200 140 1 0 0;
#X restore 388 226 graph;
#X obj 8 475 tabwrite spk_amps;
#X obj 128 440 - 1;
#X obj 13 499 r /corr/delay;
#X obj 14 522 tabwrite spk_delays;
#N canvas 0 50 450 250 (subpatch) 0;
#X array spk_delays 13 float 3;
#A 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
#X coords 0 100 12 0 200 140 1 0 0;
#X restore 389 393 graph;
#X msg 39 387 0;
#X obj 35 111 for++ 1 13 1000 1;
#X obj 8 415 r /corr/amplitude;
#X obj 8 447 spigot;
#X msg 73 387 1;
#X obj 39 245 del 100;
#X obj 39 362 del 500;
#X text 23 7 make measurement;
#X obj 30 72 print cal_end;
#X text 200 216 set out channel and vol;
#X text 106 245 wait to stabilize sound field;
#X text 97 364 measure amplitude;
#X text 119 503 save in tables;
#X connect 0 0 11 0;
#X connect 0 0 16 0;
#X connect 1 0 21 0;
#X connect 2 0 21 2;
#X connect 5 0 6 0;
#X connect 6 0 28 0;
#X connect 6 1 1 0;
#X connect 6 2 7 0;
#X connect 9 0 4 0;
#X connect 11 0 25 0;
#X connect 11 1 9 0;
#X connect 11 2 8 0;
#X connect 12 0 13 0;
#X connect 16 0 15 1;
#X connect 16 0 18 1;
#X connect 17 0 18 0;
#X connect 20 0 4 0;
#X connect 20 0 23 1;
#X connect 21 0 0 0;
#X connect 22 0 23 0;
#X connect 23 0 15 0;
#X connect 24 0 23 1;
#X connect 25 0 12 0;
#X connect 25 0 10 0;
#X connect 25 0 24 0;
#X connect 25 0 26 0;
#X connect 26 0 20 0;
#X restore 161 28 pd automeasurement;
#X obj 396 53 ds/ctl /cal;
#N canvas 599 198 450 404 write2outs 0;
#X obj 21 68 for++ 1 13 10 1;
#X obj 25 10 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 18 161 tabread spk_amps;
#X obj 19 92 t f f;
#X obj 19 334 pack 0 1 1;
#X obj 43 263 tabread spk_delays;
#X msg 20 355 \; /out/\$3/vol \$1 \; /out/\$3/del \$2;
#X obj 25 30 t b b;
#X floatatom 206 91 5 0 0 0 - - -, f 5;
#X obj 204 56 array min spk_amps;
#X obj 18 187 - 57;
#X obj 18 209 * -1;
#X obj 18 231 + 100;
#X floatatom 214 174 5 0 0 0 - - -, f 5;
#X obj 212 139 array min spk_delays;
#X obj 42 294 - 30;
#X obj 68 125 - 1;
#X obj 20 126 - 1;
#X connect 0 0 3 0;
#X connect 1 0 7 0;
#X connect 2 0 10 0;
#X connect 3 0 17 0;
#X connect 3 1 16 0;
#X connect 3 1 4 2;
#X connect 4 0 6 0;
#X connect 5 0 15 0;
#X connect 7 0 0 0;
#X connect 7 1 9 0;
#X connect 7 1 14 0;
#X connect 8 0 10 1;
#X connect 9 0 8 0;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X connect 12 0 4 0;
#X connect 13 0 15 1;
#X connect 14 0 13 0;
#X connect 15 0 4 1;
#X connect 16 0 5 0;
#X connect 17 0 2 0;
#X restore 309 31 pd write2outs;
#X obj 28 258 amb/outs_ctl boxen 13 out;
#X text 334 259 --- watch measurement ---;
#X text 146 264 --- debug ---;
